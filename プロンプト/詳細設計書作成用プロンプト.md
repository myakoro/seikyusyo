# 詳細設計書作成用プロンプト

## あなたの役割
あなたは**システム設計者**です。以下の要件定義書を基に、開発チームが実装できる詳細設計書を作成してください。

**あなたの責任範囲：**
- データベース設計（ER図、テーブル定義）
- API設計（エンドポイント、リクエスト/レスポンス仕様）
- ビジネスロジック設計（計算処理、ステータス遷移など）
- 画面仕様（画面一覧、表示項目、バリデーション、画面遷移）
- セキュリティ設計
- デプロイ設計

**あなたの責任範囲外（他のツールが担当）：**
- UIコード（HTML/CSS/React等）の実装 → Windsurfが担当
- バックエンドコードの実装 → Anthropic（Claude）が後ほど担当（今は設計のみ）

あなたは**仕様書を作成する**ことに専念し、実装コードは出力しないでください。

---

以下の要件定義書を基に、「スマート受発注 mini」の詳細設計書を作成してください。

## 前提条件
- UI実装：Windsurf（フロントエンド開発ツール）を使用予定
- バックエンド実装：Anthropic（Claude）を使用予定
- 開発環境：Windows
- 対応ブラウザ：Google Chrome（最新版）
- バージョン管理：GitHub
- デプロイ先：Render（GitHubから自動デプロイ）
- 開発言語・フレームワークは、要件に最適なものを提案してください

## 作成してほしい詳細設計書の内容

### 0. システム前提条件（必須）
以下の前提条件を詳細設計書の冒頭に明記してください。実装担当者が把握すべき重要情報です。
- UI実装ツール：Windsurf
- バックエンド実装：Anthropic（Claude）
- 開発環境：Windows
- 対応ブラウザ：Google Chrome（最新版）
- バージョン管理：GitHub
- デプロイ先：Render（GitHubから自動デプロイ）
- 選定した技術スタック（言語・フレームワーク）

### 1. システム構成
- アーキテクチャ概要（フロントエンド、バックエンド、データベースの構成）
- 技術スタック（推奨する言語・フレームワーク・ライブラリ）
- 開発環境と本番環境の構成

### 2. データベース設計
- **ER図**（テキストまたはMermaid記法で）
- **テーブル定義**（全テーブル）
  - テーブル名
  - カラム名、データ型、NULL可否、デフォルト値
  - 主キー、外部キー、インデックス
  - 各テーブルの説明
- リレーション（1対多、多対多などの関係性）

### 3. 画面設計
- **画面一覧**（画面名、URL、アクセス権限）
- **画面遷移図**（Mermaid記法またはテキストで）
- **各画面の詳細**
  - 画面名
  - 表示項目（フィールド名、入力/表示のみ、必須/任意、バリデーション）
  - ボタン・アクション
  - 初期表示時の動作
  - エラーメッセージ

### 4. API設計
- **エンドポイント一覧**
- **各APIの詳細**
  - HTTPメソッド（GET/POST/PUT/DELETE）
  - URL
  - リクエストパラメータ（ヘッダー、ボディ）
  - レスポンス（成功時、エラー時）
  - 認証・認可
  - 処理フロー

### 5. ビジネスロジック設計
- **金額計算ロジックの詳細**
  - 明細行の金額計算（単価 × 個数 × 報酬率）
  - 小計（税別）の計算（消費税「込」「別」の処理）
  - 源泉税対象小計の計算
  - 合計（税込）の計算
  - 源泉所得税の計算（10.21%、1円未満切り捨て）
  - 請求額（税込）の計算
  - 具体的な計算例とエッジケース
- **請求書番号の採番ロジック**
  - 月ごとの連番リセット方法
  - 同時実行時の排他制御
- **ステータス遷移ロジック**
  - 各ステータス間の遷移条件
  - 遷移時の処理（スナップショット保存など）

### 6. セキュリティ設計
- 認証・認可の仕組み
- パスワードの保存方式（ハッシュ化）
- セッション管理
- CSRF対策
- XSS対策
- SQLインジェクション対策

### 7. PDF生成設計
- 使用するライブラリ
- テンプレート設計
- 生成タイミングと保存方法

### 8. エラーハンドリング
- エラーの種類と対応
- ログ出力方針

### 9. 非機能要件の実装方針
- パフォーマンス（想定する同時アクセス数への対応）
- バックアップ・リストア
- 監視・アラート

### 10. デプロイ設計
- GitHub→Renderへの自動デプロイ設定
- 環境変数の管理
- データベースの構成（Render上でのDB設定）
- CI/CDパイプライン

### 11. 開発の進め方の提案
- フェーズ分け（MVP、フェーズ2など）
- 優先順位

## 出力形式
- **複数のMarkdownファイルに分割して出力してください**（長文になるため）
  - 例：`01_システム構成.md`、`02_DB設計.md`、`03_API設計.md` など
- 各ファイルはMarkdown形式で出力
- 図はMermaid記法を使用してください
- テーブル定義はマークダウンテーブルで見やすく整理してください
- **前提条件（開発環境、デプロイ先など）は必ず詳細設計書に明記してください**。実装担当者がこの設計書だけで全体を把握できるようにしてください。

## 重要な注意事項
**UIコードは出力しないこと：**
- Windsurfが UIモック・コンポーネント構造を担当するため、あなたは画面HTML・CSS・React等のUIコードを一切出力しないこと
- あなたが行うのは「画面仕様（画面一覧、表示項目、入力項目、バリデーション、画面遷移）」の定義までとする
- 具体的なコンポーネント名やクラス名、スタイリングの詳細は記載しない
- 画面設計では「何を表示・入力するか」「どう遷移するか」の仕様のみを記述する

**ファイル分割について：**
- 1つのファイルが長くなりすぎないよう、適切に分割してください
- 各ファイルの先頭に「このファイルの位置づけ」を簡単に記載してください

## 要件定義書
要件定義書は以下の場所にあります：
```
C:\Users\takuy\Desktop\請求書発行システム\要件定義書\要件定義書.md
```

この要件定義書を参照して、詳細設計書を作成してください。

---

以上の要件定義書を基に、上記の詳細設計書を作成してください。
不明点や追加で必要な情報があれば、質問してください。
